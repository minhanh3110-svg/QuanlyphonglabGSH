# ğŸ”¬ HÆ¯á»šNG DáºªN QUáº¢N LÃ MÃ” SOI

## KhÃ¡i niá»‡m "MÃ´ Soi"

**MÃ´ Soi** lÃ  káº¿t quáº£ kiá»ƒm tra tá»« chu ká»³ trÆ°á»›c (PhÃ²ng SÃ¡ng) - chÃ­nh lÃ  nguá»“n cung cáº¥p **MÃ´ Máº¹** cho chu ká»³ tiáº¿p theo.

### Quy trÃ¬nh:

```
Chu ká»³ N-1 (PhÃ²ng SÃ¡ng)
    â†“
Kiá»ƒm tra â†’ Soi mÃ´
    â†“
Äáº¿m: TÃºi sáº¡ch vs TÃºi nhiá»…m
    â†“
Nháº­p vÃ o há»‡ thá»‘ng: "MÃ´ Soi"
    â†“
Chu ká»³ N (PhÃ²ng Cáº¥y)
    â†“
Láº¥y "MÃ´ Soi" lÃ m "MÃ´ Máº¹"
    â†“
Há»‡ thá»‘ng tá»± Ä‘á»™ng kháº¥u trá»«
```

---

## ğŸ“‹ CÃC CHá»¨C NÄ‚NG CHÃNH

### 1. QUáº¢N LÃ MÃ” SOI

**Menu:** "Quáº£n lÃ½ MÃ´ Soi"

#### Tab 1: Nháº­p MÃ´ Soi

**Má»¥c Ä‘Ã­ch:** Nháº­p káº¿t quáº£ kiá»ƒm tra tá»« PhÃ²ng SÃ¡ng

**ThÃ´ng tin cáº§n nháº­p:**
- ğŸŒ± TÃªn giá»‘ng
- ğŸ”„ Chu ká»³ trÆ°á»›c (NhÃ¢n nhanh / Ra rá»… / v.v.)
- ğŸ“… NgÃ y kiá»ƒm tra (soi)
- ğŸ”¢ Tá»•ng sá»‘ tÃºi ban Ä‘áº§u
- âŒ Sá»‘ tÃºi nhiá»…m
- âœ… Sá»‘ cá»¥m má»—i tÃºi sáº¡ch

**Tá»± Ä‘á»™ng tÃ­nh:**
- Sá»‘ tÃºi sáº¡ch = Tá»•ng - Nhiá»…m
- Tá»•ng cá»¥m sáº¡ch = TÃºi sáº¡ch Ã— Cá»¥m/tÃºi
- Tá»· lá»‡ sáº¡ch %
- Tá»· lá»‡ nhiá»…m %

**MÃ£ lÃ´:** Tá»± Ä‘á»™ng sinh ra dáº¡ng `MS-YYYYMMDD-XXX`

**VÃ­ dá»¥:**
```
TÃªn giá»‘ng: Äá»“ng tiá»n Ä‘á»
Chu ká»³ trÆ°á»›c: NhÃ¢n nhanh
NgÃ y soi: 02/01/2026
Tá»•ng tÃºi: 100
TÃºi nhiá»…m: 15
Cá»¥m/tÃºi: 5

â†’ Káº¿t quáº£:
  TÃºi sáº¡ch: 85 tÃºi
  Tá»•ng cá»¥m: 425 cá»¥m
  Tá»· lá»‡ sáº¡ch: 85%
  Tá»· lá»‡ nhiá»…m: 15%
  MÃ£ lÃ´: MS-20260102-001
```

**Cáº£nh bÃ¡o:**
- Tá»· lá»‡ nhiá»…m > 20%: ğŸ”´ Cáº£nh bÃ¡o Ä‘á»
- Tá»· lá»‡ nhiá»…m 10-20%: âš ï¸ Cáº£nh bÃ¡o vÃ ng

---

#### Tab 2: Danh sÃ¡ch MÃ´ Soi

**Hiá»ƒn thá»‹:**
- Táº¥t cáº£ lÃ´ MÃ´ Soi
- ThÃ´ng tin: MÃ£ lÃ´, Giá»‘ng, Chu ká»³, NgÃ y soi
- Sá»‘ liá»‡u: TÃºi ban Ä‘áº§u, TÃºi nhiá»…m, TÃºi sáº¡ch, Cá»¥m/tÃºi
- TÃ¬nh tráº¡ng: Tá»•ng cá»¥m, ÄÃ£ cáº¥p, CÃ²n láº¡i
- Tráº¡ng thÃ¡i: "Äang sá»­ dá»¥ng" / "ÄÃ£ káº¿t thÃºc chu ká»³"

**Metrics tá»•ng quan:**
- LÃ´ Ä‘ang sá»­ dá»¥ng
- Tá»•ng cá»¥m cÃ²n láº¡i
- Tá»•ng cá»¥m Ä‘Ã£ cáº¥p
- LÃ´ Ä‘Ã£ káº¿t thÃºc

**MÃ u sáº¯c:**
- ğŸŸ¢ Xanh: Äang sá»­ dá»¥ng, cÃ²n cá»¥m
- ğŸŸ¡ VÃ ng: Äang sá»­ dá»¥ng, gáº§n háº¿t
- ğŸ”´ Äá» nháº¡t: ÄÃ£ káº¿t thÃºc chu ká»³

---

#### Tab 3: BÃ¡o cÃ¡o Sá»­ dá»¥ng

**Thá»‘ng kÃª theo giá»‘ng:**
- Sá»‘ lÃ´
- Tá»•ng cá»¥m
- ÄÃ£ cáº¥p
- CÃ²n láº¡i
- Tá»· lá»‡ nhiá»…m trung bÃ¬nh

**Biá»ƒu Ä‘á»“:** Stacked bar chart (ÄÃ£ cáº¥p vs CÃ²n láº¡i)

---

### 2. Äá»I SOÃT MÃ” SOI

**Menu:** "Äá»‘i soÃ¡t MÃ´ Soi"

**Má»¥c Ä‘Ã­ch:** Check & Balance - Kiá»ƒm tra tá»•ng MÃ´ Soi cÃ³ khá»›p vá»›i tá»•ng MÃ´ Máº¹ Ä‘Ã£ cáº¥y hay khÃ´ng

#### Báº£ng Ä‘á»‘i soÃ¡t:

| TÃªn giá»‘ng | Tá»•ng cá»¥m MÃ´ Soi | ÄÃ£ cáº¥p (há»‡ thá»‘ng) | CÃ²n láº¡i | MÃ´ Máº¹ Ä‘Ã£ cáº¥y (nháº­t kÃ½) | ChÃªnh lá»‡ch | Tráº¡ng thÃ¡i |
|-----------|----------------|-------------------|---------|------------------------|------------|-----------|
| Äá»“ng tiá»n Ä‘á» | 425 | 425 | 0 | 425 | 0 | âœ… KHá»šP |
| Khoai lang tÃ­m | 300 | 200 | 100 | 200 | 0 | âš ï¸ DÆ¯ MÃ” (100 cá»¥m) |
| CÃ¢y xuáº¥t kháº©u A | 150 | 150 | 0 | 180 | -30 | ğŸ”´ Báº¤T THÆ¯á»œNG (VÆ°á»£t 30 cá»¥m) |

#### Tráº¡ng thÃ¡i:

1. **âœ… KHá»šP:** 
   - Tá»•ng MÃ´ Máº¹ Ä‘Ã£ cáº¥p = Tá»•ng MÃ´ Soi Ä‘Ã£ cáº¥p
   - Dá»¯ liá»‡u chÃ­nh xÃ¡c

2. **âš ï¸ DÆ¯ MÃ”:**
   - CÃ²n MÃ´ Soi chÆ°a cáº¥y háº¿t
   - Gá»£i Ã½: Äáº©y nhanh tiáº¿n Ä‘á»™ hoáº·c há»§y bá» náº¿u Ä‘á»ƒ quÃ¡ lÃ¢u

3. **ğŸ”´ Báº¤T THÆ¯á»œNG:**
   - MÃ´ Máº¹ Ä‘Ã£ cáº¥p > MÃ´ Soi cÃ³ sáºµn
   - KHÃ”NG thá»ƒ xáº£y ra trong thá»±c táº¿!
   - NguyÃªn nhÃ¢n:
     - NhÃ¢n viÃªn nháº­p nháº­t kÃ½ nhÆ°ng khÃ´ng chá»n Ä‘Ãºng lÃ´ MÃ´ Soi
     - LÃ´ MÃ´ Soi chÆ°a Ä‘Æ°á»£c nháº­p vÃ o há»‡ thá»‘ng
     - Dá»¯ liá»‡u nháº­p sai

#### Metrics tá»•ng quan:
- âœ… Giá»‘ng khá»›p
- âš ï¸ Giá»‘ng dÆ° mÃ´
- ğŸ”´ Giá»‘ng báº¥t thÆ°á»ng

---

### 3. LIÃŠN Káº¾T Vá»šI NHáº¬T KÃ Cáº¤Y

**Menu:** "Nháº­p liá»‡u"

#### Quy trÃ¬nh:

1. **Chá»n giá»‘ng cÃ¢y**
   - Há»‡ thá»‘ng tá»± Ä‘á»™ng tÃ¬m lÃ´ MÃ´ Soi kháº£ dá»¥ng cho giá»‘ng Ä‘Ã³

2. **Dropdown chá»n lÃ´ MÃ´ Soi**
   ```
   MS-20260102-001 | NhÃ¢n nhanh | CÃ²n: 425 cá»¥m (85 tÃºi x 5 cá»¥m)
   MS-20260103-002 | Ra rá»… | CÃ²n: 300 cá»¥m (60 tÃºi x 5 cá»¥m)
   ```

3. **Hiá»ƒn thá»‹ thÃ´ng tin lÃ´ Ä‘Ã£ chá»n:**
   - ğŸ“¦ MÃ£ lÃ´
   - ğŸ”„ Chu ká»³ trÆ°á»›c
   - âœ… CÃ²n láº¡i (cá»¥m)
   - ğŸ“Š Tá»‘i Ä‘a (tÃºi)

4. **Nháº­p sá»‘ tÃºi máº¹ vÃ  sá»‘ cá»¥m/tÃºi**
   - VÃ­ dá»¥: 10 tÃºi Ã— 5 cá»¥m = 50 cá»¥m

5. **Khi báº¥m "LÆ°u":**
   - Há»‡ thá»‘ng tá»± Ä‘á»™ng kháº¥u trá»« 50 cá»¥m tá»« lÃ´ MÃ´ Soi
   - Cáº­p nháº­t: ÄÃ£ cáº¥p +50, CÃ²n láº¡i -50
   - LÆ°u `ma_lo_mo_soi` vÃ o nháº­t kÃ½ cáº¥y
   - Hiá»ƒn thá»‹ thÃ´ng bÃ¡o thÃ nh cÃ´ng

#### Cáº£nh bÃ¡o:

**âŒ KhÃ´ng cÃ³ MÃ´ Soi:**
```
ğŸš« KHÃ”NG CÃ“ MÃ” SOI CHO GIá»NG: Äá»“ng tiá»n Ä‘á»

NguyÃªn nhÃ¢n:
- ChÆ°a nháº­p káº¿t quáº£ kiá»ƒm tra MÃ´ Soi tá»« phÃ²ng sÃ¡ng
- MÃ´ Soi cá»§a giá»‘ng nÃ y Ä‘Ã£ háº¿t

HÃ nh Ä‘á»™ng:
1. VÃ o trang "Quáº£n lÃ½ MÃ´ Soi"
2. Nháº­p káº¿t quáº£ kiá»ƒm tra tá»« chu ká»³ trÆ°á»›c
3. Quay láº¡i nháº­p nháº­t kÃ½ cáº¥y

âš ï¸ KHÃ”NG THá»‚ NHáº¬P NHáº¬T KÃ náº¿u khÃ´ng cÃ³ MÃ´ Soi!
```

**âš ï¸ KhÃ´ng Ä‘á»§ cá»¥m:**
```
âš ï¸ MÃ´ soi Äá»“ng tiá»n Ä‘á» chá»‰ cÃ²n 30 cá»¥m, khÃ´ng Ä‘á»§ 50 cá»¥m

HÃ nh Ä‘á»™ng:
- Giáº£m sá»‘ tÃºi máº¹ hoáº·c sá»‘ cá»¥m/tÃºi
- Hoáº·c nháº­p thÃªm MÃ´ Soi cho giá»‘ng nÃ y
```

---

## ğŸ”„ LOGIC Tá»° Äá»˜NG

### 1. Kháº¥u trá»« FIFO

- Khi nháº­p nháº­t kÃ½ cáº¥y, há»‡ thá»‘ng tá»± Ä‘á»™ng:
  1. TÃ­nh sá»‘ cá»¥m cáº§n dÃ¹ng = Sá»‘ tÃºi máº¹ Ã— Sá»‘ cá»¥m/tÃºi máº¹
  2. Kiá»ƒm tra lÃ´ MÃ´ Soi cÃ²n Ä‘á»§ khÃ´ng
  3. Kháº¥u trá»« sá»‘ cá»¥m
  4. Cáº­p nháº­t: `so_cum_da_cap` vÃ  `so_cum_con_lai`
  5. LÆ°u `ma_lo_mo_soi` vÃ o nháº­t kÃ½

### 2. Tá»± Ä‘á»™ng Ä‘Ã¡nh dáº¥u háº¿t chu ká»³

- Khi `so_cum_con_lai` = 0:
  - Tráº¡ng thÃ¡i â†’ "ÄÃ£ káº¿t thÃºc chu ká»³"
  - Hiá»ƒn thá»‹ mÃ u Ä‘á» nháº¡t trong báº£ng
  - KhÃ´ng cÃ²n xuáº¥t hiá»‡n trong dropdown chá»n lÃ´

### 3. Äá»‘i soÃ¡t tá»± Ä‘á»™ng

- Dashboard "Äá»‘i soÃ¡t MÃ´ Soi" tá»± Ä‘á»™ng:
  1. TÃ­nh tá»•ng cá»¥m MÃ´ Soi tá»« báº£ng `mo_soi`
  2. TÃ­nh tá»•ng cá»¥m MÃ´ Máº¹ tá»« báº£ng `nhat_ky_cay`
  3. So sÃ¡nh vÃ  phÃ¢n loáº¡i tráº¡ng thÃ¡i
  4. Hiá»ƒn thá»‹ cáº£nh bÃ¡o náº¿u báº¥t thÆ°á»ng

---

## ğŸ“Š DATABASE SCHEMA

### Báº£ng `mo_soi`:

```sql
CREATE TABLE mo_soi (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    ma_lo_mo_soi TEXT UNIQUE NOT NULL,
    ten_giong TEXT NOT NULL,
    chu_ky_truoc TEXT NOT NULL,
    ngay_soi TEXT NOT NULL,
    tuan_soi INTEGER NOT NULL,
    nam INTEGER NOT NULL,
    so_luong_ban_dau INTEGER NOT NULL,
    so_tui_nhiem INTEGER NOT NULL,
    so_tui_sach INTEGER NOT NULL,
    so_cum_moi_tui INTEGER NOT NULL,
    tong_cum_sach INTEGER NOT NULL,
    so_cum_da_cap INTEGER DEFAULT 0,
    so_cum_con_lai INTEGER NOT NULL,
    trang_thai TEXT NOT NULL DEFAULT 'Äang sá»­ dá»¥ng',
    nguoi_soi TEXT NOT NULL,
    ma_nhan_vien TEXT NOT NULL,
    ghi_chu TEXT,
    ngay_tao TEXT NOT NULL,
    ngay_cap_nhat TEXT NOT NULL
);
```

### Báº£ng `nhat_ky_cay` (cá»™t má»›i):

```sql
ALTER TABLE nhat_ky_cay ADD COLUMN ma_lo_mo_soi TEXT;
```

---

## ğŸ¯ USE CASE

### Case 1: Nháº­p MÃ´ Soi má»›i

```
1. PhÃ²ng SÃ¡ng hoÃ n thÃ nh chu ká»³ "NhÃ¢n nhanh" cho "Äá»“ng tiá»n Ä‘á»"
2. Kiá»ƒm tra: 100 tÃºi ban Ä‘áº§u, 15 tÃºi nhiá»…m, 85 tÃºi sáº¡ch, 5 cá»¥m/tÃºi
3. VÃ o "Quáº£n lÃ½ MÃ´ Soi" â†’ Tab "Nháº­p MÃ´ Soi"
4. Nháº­p thÃ´ng tin
5. Há»‡ thá»‘ng tÃ­nh: 425 cá»¥m sáº¡ch (85Ã—5)
6. LÆ°u â†’ MÃ£ lÃ´: MS-20260102-001
7. Tráº¡ng thÃ¡i: "Äang sá»­ dá»¥ng"
```

### Case 2: Nháº­p Nháº­t kÃ½ Cáº¥y

```
1. NhÃ¢n viÃªn vÃ o "Nháº­p liá»‡u"
2. Chá»n giá»‘ng: "Äá»“ng tiá»n Ä‘á»"
3. Há»‡ thá»‘ng hiá»‡n dropdown:
   "MS-20260102-001 | NhÃ¢n nhanh | CÃ²n: 425 cá»¥m"
4. Chá»n lÃ´ MS-20260102-001
5. Nháº­p: 10 tÃºi máº¹, 5 cá»¥m/tÃºi â†’ 50 cá»¥m
6. Nháº­p cÃ¡c thÃ´ng tin khÃ¡c
7. Báº¥m "LÆ°u"
8. Há»‡ thá»‘ng:
   - Kháº¥u trá»« 50 cá»¥m tá»« MS-20260102-001
   - Cáº­p nháº­t: ÄÃ£ cáº¥p = 50, CÃ²n láº¡i = 375
   - LÆ°u ma_lo_mo_soi vÃ o nháº­t kÃ½
9. ThÃ´ng bÃ¡o:
   "âœ… LÆ°u thÃ nh cÃ´ng!
   ğŸ”¬ ÄÃ£ kháº¥u trá»« 50 cá»¥m tá»« lÃ´ MS-20260102-001
   ğŸ“Š LÃ´ MÃ´ Soi cÃ²n láº¡i: 375 cá»¥m"
```

### Case 3: Háº¿t MÃ´ Soi

```
1. LÃ´ MS-20260102-001 cÃ²n 20 cá»¥m
2. NhÃ¢n viÃªn nháº­p nháº­t kÃ½: 4 tÃºi Ã— 5 cá»¥m = 20 cá»¥m
3. Báº¥m "LÆ°u"
4. Há»‡ thá»‘ng kháº¥u trá»« 20 cá»¥m
5. CÃ²n láº¡i = 0
6. Tá»± Ä‘á»™ng Ä‘Ã¡nh dáº¥u: "ÄÃ£ káº¿t thÃºc chu ká»³"
7. LÃ´ khÃ´ng cÃ²n xuáº¥t hiá»‡n trong dropdown
```

### Case 4: KhÃ´ng Ä‘á»§ MÃ´ Soi

```
1. LÃ´ cÃ²n 20 cá»¥m
2. NhÃ¢n viÃªn nháº­p: 10 tÃºi Ã— 5 cá»¥m = 50 cá»¥m
3. Báº¥m "LÆ°u"
4. Há»‡ thá»‘ng cáº£nh bÃ¡o:
   "âš ï¸ MÃ´ soi chá»‰ cÃ²n 20 cá»¥m, khÃ´ng Ä‘á»§ 50 cá»¥m"
5. KHÃ”NG LÆ¯U nháº­t kÃ½
6. Gá»£i Ã½ giáº£m sá»‘ tÃºi hoáº·c nháº­p thÃªm MÃ´ Soi
```

### Case 5: Äá»‘i soÃ¡t phÃ¡t hiá»‡n báº¥t thÆ°á»ng

```
1. Admin vÃ o "Äá»‘i soÃ¡t MÃ´ Soi"
2. Há»‡ thá»‘ng tÃ­nh:
   - Tá»•ng MÃ´ Soi "Äá»“ng tiá»n Ä‘á»": 425 cá»¥m
   - ÄÃ£ cáº¥p (há»‡ thá»‘ng): 425 cá»¥m
   - MÃ´ Máº¹ Ä‘Ã£ cáº¥y (nháº­t kÃ½): 450 cá»¥m
   - ChÃªnh lá»‡ch: -25 cá»¥m
3. Tráº¡ng thÃ¡i: "ğŸ”´ Báº¤T THÆ¯á»œNG (VÆ°á»£t 25 cá»¥m)"
4. Cáº£nh bÃ¡o Ä‘á»:
   "ğŸš¨ Cáº¢NH BÃO NGHIÃŠM TRá»ŒNG!
   Dá»¯ liá»‡u báº¥t thÆ°á»ng - cáº§n kiá»ƒm tra láº¡i!"
5. Admin kiá»ƒm tra:
   - PhÃ¡t hiá»‡n 1 nhÃ¢n viÃªn nháº­p nháº­t kÃ½ khÃ´ng chá»n lÃ´ MÃ´ Soi
   - Sá»­a láº¡i dá»¯ liá»‡u
   - Äá»‘i soÃ¡t láº¡i â†’ âœ… KHá»šP
```

---

## âš ï¸ LÆ¯U Ã QUAN TRá»ŒNG

### 1. Báº®T BUá»˜C pháº£i cÃ³ MÃ´ Soi trÆ°á»›c khi nháº­p nháº­t kÃ½
- Náº¿u khÃ´ng cÃ³ MÃ´ Soi cho giá»‘ng Ä‘Ã³, KHÃ”NG THá»‚ nháº­p nháº­t kÃ½ cáº¥y

### 2. Quy trÃ¬nh ÄÃšNG:
```
PhÃ²ng SÃ¡ng kiá»ƒm tra
    â†“
Nháº­p MÃ´ Soi vÃ o há»‡ thá»‘ng
    â†“
Má»›i Ä‘Æ°á»£c nháº­p Nháº­t kÃ½ Cáº¥y
```

### 3. Quy trÃ¬nh SAI (sáº½ bá»‹ cháº·n):
```
Nháº­p Nháº­t kÃ½ Cáº¥y trÆ°á»›c
    â†“
âŒ Há»† THá»NG CHáº¶N: "KhÃ´ng cÃ³ MÃ´ Soi!"
```

### 4. Äá»‘i soÃ¡t thÆ°á»ng xuyÃªn:
- Admin nÃªn vÃ o "Äá»‘i soÃ¡t MÃ´ Soi" má»—i ngÃ y
- Kiá»ƒm tra cÃ³ báº¥t thÆ°á»ng khÃ´ng
- Xá»­ lÃ½ ngay náº¿u phÃ¡t hiá»‡n sai sÃ³t

### 5. MÃ´ Soi cÃ²n dÆ°:
- Náº¿u Ä‘á»ƒ quÃ¡ lÃ¢u, cháº¥t lÆ°á»£ng giáº£m
- NÃªn Ä‘áº©y nhanh tiáº¿n Ä‘á»™ cáº¥y
- Hoáº·c há»§y bá» vÃ  nháº­p lÃ´ má»›i

---

## ğŸš€ TRIá»‚N KHAI

```powershell
cd D:\QUANLYLAB
git add app.py
git commit -m "Feature: Add Mo Soi Management System"
git push origin master
```

**Reboot Streamlit Cloud:**
1. VÃ o https://share.streamlit.io
2. Reboot app: QuanLyPhongLabGSH
3. Äá»£i 2-5 phÃºt
4. Test: https://quanlyphonglabgsh-upgfgca3bsddruuap6qja2.streamlit.app/

---

**Green Straw Hat - Happiness Together ğŸŒ±**

**PhiÃªn báº£n:** 2.1
**NgÃ y:** 02/01/2026
**TÃ­nh nÄƒng:** Quáº£n lÃ½ MÃ´ Soi hoÃ n chá»‰nh vá»›i Check & Balance

